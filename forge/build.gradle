// Forge module - Minecraft Forge specific implementation

plugins {
    id 'java'
    id 'net.minecraftforge.gradle' version '6.0.25'
    id 'org.parchmentmc.librarian.forgegradle' version '1.+'
}

// Configure Java toolchain for Java 21
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

// Minecraft and Forge configuration
minecraft {
    // Mappings for 1.21.1
    mappings channel: 'official', version: '1.21.1'
    
    runs {
        client {
            workingDirectory project.file('run')
            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            
            // JVM arguments to fix module issues with Java 21
            jvmArgs '-XX:+IgnoreUnrecognizedVMOptions', '--add-modules=ALL-SYSTEM', '--add-opens=java.base/java.util.jar=ALL-UNNAMED', '--add-opens=java.base/java.lang.invoke=ALL-UNNAMED', '--add-exports=java.base/sun.security.util=ALL-UNNAMED', '--add-exports=jdk.naming.dns/com.sun.jndi.dns=ALL-UNNAMED,java.naming', '--add-opens=java.base/java.nio=ALL-UNNAMED', '--add-opens=java.logging/java.util.logging=ALL-UNNAMED'
            
            mods {
                dominionrising {
                    source sourceSets.main
                    source project(':common').sourceSets.main
                }
            }
        }
        
        server {
            workingDirectory project.file('run')
            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            
            // JVM arguments to fix module issues with Java 21
            jvmArgs '-XX:+IgnoreUnrecognizedVMOptions', '--add-modules=ALL-SYSTEM', '--add-opens=java.base/java.util.jar=ALL-UNNAMED', '--add-opens=java.base/java.lang.invoke=ALL-UNNAMED', '--add-exports=java.base/sun.security.util=ALL-UNNAMED', '--add-exports=jdk.naming.dns/com.sun.jndi.dns=ALL-UNNAMED,java.naming', '--add-opens=java.base/java.nio=ALL-UNNAMED', '--add-opens=java.logging/java.util.logging=ALL-UNNAMED'
            
            mods {
                dominionrising {
                    source sourceSets.main
                    source project(':common').sourceSets.main
                }
            }
        }
    }
}

repositories {
    maven {
        name = 'MinecraftForge'
        url = 'https://maven.minecraftforge.net/'
    }
}

dependencies {
    minecraft 'net.minecraftforge:forge:1.21.1-52.0.17'
    
    // Common module dependency
    implementation project(':common')
}

// Include common sources in jar
jar {
    from project(':common').sourceSets.main.output
}
