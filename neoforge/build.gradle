// NeoForge module - NeoForge specific implementation

plugins {
    id 'java'
    id 'net.neoforged.gradle.userdev' version '7.0.145'
}

// Configure Java toolchain for Java 21
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

// NeoForge configuration
runs {
    client {
        systemProperty 'neoforge.logging.markers', 'REGISTRIES'
        systemProperty 'neoforge.logging.console.level', 'debug'
        
        // JVM arguments to disable module system and fix conflicts with Java 21
        jvmArguments = [
            '-XX:+IgnoreUnrecognizedVMOptions',
            '--illegal-access=permit',
            '--add-opens=java.base/java.lang=ALL-UNNAMED',
            '--add-opens=java.base/java.util=ALL-UNNAMED',
            '--add-opens=java.base/java.io=ALL-UNNAMED',
            '--add-opens=java.base/java.nio=ALL-UNNAMED',
            '--add-opens=java.base/sun.nio.ch=ALL-UNNAMED',
            '--add-opens=java.base/java.net=ALL-UNNAMED',
            '--add-opens=java.base/java.util.concurrent=ALL-UNNAMED',
            '--add-opens=java.base/sun.util.locale=ALL-UNNAMED',
            '--add-opens=java.base/sun.util.locale.provider=ALL-UNNAMED',
            '--add-opens=java.logging/java.util.logging=ALL-UNNAMED'
        ]
    }
    
    server {
        systemProperty 'neoforge.logging.markers', 'REGISTRIES'
        systemProperty 'neoforge.logging.console.level', 'debug'
        
        // JVM arguments to disable module system and fix conflicts with Java 21
        jvmArguments = [
            '-XX:+IgnoreUnrecognizedVMOptions',
            '--illegal-access=permit',
            '--add-opens=java.base/java.lang=ALL-UNNAMED',
            '--add-opens=java.base/java.util=ALL-UNNAMED',
            '--add-opens=java.base/java.io=ALL-UNNAMED',
            '--add-opens=java.base/java.nio=ALL-UNNAMED',
            '--add-opens=java.base/sun.nio.ch=ALL-UNNAMED',
            '--add-opens=java.base/java.net=ALL-UNNAMED',
            '--add-opens=java.base/java.util.concurrent=ALL-UNNAMED',
            '--add-opens=java.base/sun.util.locale=ALL-UNNAMED',
            '--add-opens=java.base/sun.util.locale.provider=ALL-UNNAMED',
            '--add-opens=java.logging/java.util.logging=ALL-UNNAMED'
        ]
    }
}

repositories {
    maven {
        name = 'NeoForged'
        url = 'https://maven.neoforged.net/releases'
    }
}

dependencies {
    implementation "net.neoforged:neoforge:21.1.57"
    
    // Common module dependency  
    implementation project(':common')
}

// Include common sources in jar
jar {
    from project(':common').sourceSets.main.output
}
// Dependencies on common module will be configured here
